<section id="contact" class="py-32 bg-neutral-100 scroll-mt-32">
  <div class="max-w-7xl mx-auto px-6">

    <div class="grid gap-16 md:grid-cols-2 items-start">

      <!-- Info -->
      <div class="max-w-xl">
        <h2 class="text-5xl font-bold mb-6 leading-tight">
          Hablemos de tu proyecto
        </h2>

        <p class="text-gray-500 text-xl mb-12">
          Contanos qué necesitás y te ayudamos a construir una solución
          clara, funcional y bien diseñada.
        </p>

        <!-- Phones as uniform width CTA buttons -->
        <div class="flex flex-col gap-3 mb-6">
          <a
            href="tel:25191211"
            class="inline-block text-lg font-semibold text-white bg-gradient-to-r from-purple-500 to-indigo-500 rounded-md shadow-sm px-4 py-2 w-48 text-center hover:scale-105 transform transition"
          >
            2519-1211
          </a>

          <a
            href="tel:73981937"
            class="inline-block text-lg font-semibold text-white bg-gradient-to-r from-purple-500 to-indigo-500 rounded-md shadow-sm px-4 py-2 w-48 text-center hover:scale-105 transform transition"
          >
            7398-1937
          </a>

          <p class="text-sm text-gray-500 mt-1">
            Lunes a viernes · 8:00 AM – 6:00 PM
          </p>
        </div>

      </div>

      <!-- Form -->
      <form
        class="
          bg-white
          rounded-xl
          p-10
          border
          border-gray-200
        "
      >
        <div class="space-y-6">

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Nombre
            </label>
            <input
              name="nombre"
              type="text"
              placeholder="Tu nombre"
              required
              oninvalid="this.setCustomValidity('Por favor, ingresa tu nombre.')"
              oninput="this.setCustomValidity('')"
              class="
                w-full
                border
                border-gray-300
                rounded-md
                px-4
                py-3
                focus:outline-none
                focus:ring-2
                focus:ring-black/10
              "
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Email
            </label>
            <input
              name="email"
              type="email"
              placeholder="tu@email.com"
              required
              oninvalid="this.setCustomValidity('Por favor, ingresa tu email.')"
              oninput="this.setCustomValidity('')"
              class="
                w-full
                border
                border-gray-300
                rounded-md
                px-4
                py-3
                focus:outline-none
                focus:ring-2
                focus:ring-black/10
              "
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Teléfono
            </label>
            <input
              name="telefono"
              type="tel"
              placeholder="Tu número de teléfono"
              oninvalid="this.setCustomValidity('Por favor, ingresa tu número de teléfono.')"
              oninput="this.setCustomValidity('')"
              required
              class="
                w-full
                border
                border-gray-300
                rounded-md
                px-4
                py-3
                focus:outline-none
                focus:ring-2
                focus:ring-black/10
              "
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Mensaje
            </label>
            <textarea
              name="mensaje"
              rows="4"
              placeholder="Contanos sobre tu proyecto"
              oninvalid="this.setCustomValidity('Debes ingresar una descripción.')"
              oninput="this.setCustomValidity('')"
              required
              class="
                w-full
                border
                border-gray-300
                rounded-md
                px-4
                py-3
                resize-none
                focus:outline-none
                focus:ring-2
                focus:ring-black/10
              "
            ></textarea>
          </div>

          <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">

          <button
            type="submit"
            id="submit-button"
            class="
              w-full
              bg-black
              text-white
              font-medium
              py-4
              rounded-md
              hover:opacity-90
              transition
            "
          >
            Enviar mensaje
          </button>

        </div>
        <div
          id="form-error"
          class="hidden mt-6 rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-600"
        ></div>
        <div
          id="form-message"
          class="hidden mt-6 rounded-md border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-600"
        ></div>
      </form>

      <script>
        const form = document.querySelector("form");
        const errorBox = document.getElementById("form-error");
        const messageBox = document.getElementById("form-message");
        const submitButton = document.getElementById("submit-button")
        console.log(submitButton)

        let errorTimeout = null;
        let messageTimeout = null;

        //Carga del formulario
        const formLoadTime = Date.now()
        
        function clearError() {
          errorBox.textContent = "";
          errorBox.classList.add("hidden");
          if(errorTimeout) {
            clearTimeout(errorTimeout)
          }
          errorTimeout = null
        }

        function clearMessage() {
          messageBox.textContent = "";
          messageBox.classList.add("hidden");
          if(messageTimeout) {
            clearTimeout(messageTimeout)
          }
          messageTimeout = null
        }
        
        function showMessage(message) {
          clearMessage()
          messageBox.textContent = message;
          messageBox.classList.remove("hidden");
          messageTimeout = setTimeout(() => {
            clearMessage()
          }, 3000);
        }


        function showError(message) {
          clearError()
          errorBox.textContent = message;
          errorBox.classList.remove("hidden");
          errorTimeout = setTimeout(() => {
            clearError()
          }, 3000);
        }


        form?.addEventListener("submit", async (e) => {
          e.preventDefault();
          clearError();

          const formData = Object.fromEntries(new FormData(form));

          //Honeypot
          if(formData.website) {
            return;
          }

          //Too fast submit
          const now = Date.now()
          if(now - formLoadTime < 3000) {
            return
          }

          formData.nombre = formData.nombre.trim();
          formData.email = formData.email.trim();
          formData.mensaje = formData.mensaje.trim();
          formData.telefono = formData.telefono
            .replace(/\s+/g, "")
            .replace(/\D/g, "");

          if (formData.nombre.length < 2 || formData.nombre.length > 60) {
            showError("El nombre debe tener entre 2 y 60 caracteres.");
            return;
          }

          if (!formData.email) {
            showError("Ingresá un email válido.");
            return;
          }

          if (formData.telefono.length < 8 || formData.telefono.length > 15) {
            showError("El teléfono debe contener solo números y ser válido.");
            return;
          }

          if (formData.mensaje.length < 10 || formData.mensaje.length > 1000) {
            showError("El mensaje debe tener entre 10 y 1000 caracteres.");
            return;
          }

          try {
            submitButton.disabled = true;
            const response = await fetch(
              "https://n8n-n8n.lyacea.easypanel.host/webhook/d29401d6-22a9-4e1b-9c54-a6a1beec64cd",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData),
              }
            );

            if (!response.ok) {
              showError("Ocurrió un error al enviar el formulario.");
              return;
            }
            form.reset();
            showMessage("✅ Formulario enviado.");
            
          } catch (error) {
            console.error(error);
            showError("Error de conexión. Intentá nuevamente.");
          } finally {
            submitButton.disabled = false;
          }
        });
      </script>
    </div>
  </div>
</section>
